<html>

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>ボリューム | ラボ</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        :root {
            background-color: rgb(19, 19, 21);
            color: rgb(190, 190, 210);
        }

        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-corner {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: rgb(57, 57, 63);
            border: 0 none #fff;
            border-radius: 50px;
        }

        ::-webkit-scrollbar-track {
            border: 0 none #fff;
            border-radius: 50px;
            background: rgba(0, 0, 0, 0.2);
        }

        .cont {
            display: flex;
        }

        .bar {
            height: 20px;
            width: 200px;
            border: 1px solid rgba(200, 200, 200, 0.8);
            display: flex;
        }

        .bar.reverse {
            flex-direction: row-reverse;
        }

        .bar .item {
            height: 100%;
            transition: all 0.5s;
        }

        .bar .item.volume {
            background-color: green;
        }

        .bar .item.sell {
            background-color: red;
        }

        .bar .item.buy {
            background-color: blue;
        }

        .bar #text {
            position: absolute;
        }
    </style>
</head>

<body>
    <div id="btcusd" style="margin: 12px;">
        <div id="bitmex" class="cont">
            <div id="sell-volume" class="bar reverse">
                <div id="item" class="item sell"></div>
                <div id="text"></div>
            </div>
            <div id="buy-volume" class="bar">
                <div id="item" class="item buy"></div>
                <div id="text"></div>
            </div>
            <div>bitmex</div>
            <div id="lastprice"></div>
        </div>
        <div id="mix" class="cont">
            <div id="sell-volume" class="bar reverse">
                <div id="item" class="item sell"></div>
                <div id="text"></div>
            </div>
            <div id="buy-volume" class="bar">
                <div id="item" class="item buy"></div>
                <div id="text"></div>
            </div>
            <div>Mix</div>
        </div>
        <div id="bitfinex" class="cont">
            <div id="sell-volume" class="bar reverse">
                <div id="item" class="item sell"></div>
                <div id="text"></div>
            </div>
            <div id="buy-volume" class="bar">
                <div id="item" class="item buy"></div>
                <div id="text"></div>
            </div>
            <div>bitfinex</div>
            <div id="lastprice"></div>
        </div>
        <div id="gdax" class="cont">
            <div id="sell-volume" class="bar reverse">
                <div id="item" class="item sell"></div>
                <div id="text"></div>
            </div>
            <div id="buy-volume" class="bar">
                <div id="item" class="item buy"></div>
                <div id="text"></div>
            </div>
            <div>GDAX</div>
            <div id="lastprice"></div>
        </div>
        <div id="okcoin" class="cont">
            <div id="sell-volume" class="bar reverse">
                <div id="item" class="item sell"></div>
                <div id="text"></div>
            </div>
            <div id="buy-volume" class="bar">
                <div id="item" class="item buy"></div>
                <div id="text"></div>
            </div>
            <div>OKCoin</div>
            <div id="lastprice"></div>
        </div>
        <div id="bitstamp" class="cont">
            <div id="sell-volume" class="bar reverse">
                <div id="item" class="item sell"></div>
                <div id="text"></div>
            </div>
            <div id="buy-volume" class="bar">
                <div id="item" class="item buy"></div>
                <div id="text"></div>
            </div>
            <div>Bitstamp</div>
            <div id="lastprice"></div>
        </div>
    </div>

    <div id="btcusdt" style="margin: 12px;">
        <div id="mix" class="cont">
            <div id="sell-volume" class="bar reverse">
                <div id="item" class="item sell"></div>
                <div id="text"></div>
            </div>
            <div id="buy-volume" class="bar">
                <div id="item" class="item buy"></div>
                <div id="text"></div>
            </div>
            <div>Mix</div>
        </div>
        <div id="binance" class="cont">
            <div id="sell-volume" class="bar reverse">
                <div id="item" class="item sell"></div>
                <div id="text"></div>
            </div>
            <div id="buy-volume" class="bar">
                <div id="item" class="item buy"></div>
                <div id="text"></div>
            </div>
            <div>binance</div>
            <div id="lastprice"></div>
        </div>
        <div id="okex" class="cont">
            <div id="sell-volume" class="bar reverse">
                <div id="item" class="item sell"></div>
                <div id="text"></div>
            </div>
            <div id="buy-volume" class="bar">
                <div id="item" class="item buy"></div>
                <div id="text"></div>
            </div>
            <div>OKEx</div>
            <div id="lastprice"></div>
        </div>
    </div>

    <div id="btcjpy" style="margin: 12px;">
        <div id="bitflyerFX" class="cont">
            <div id="sell-volume" class="bar reverse">
                <div id="item" class="item sell"></div>
                <div id="text"></div>
            </div>
            <div id="buy-volume" class="bar">
                <div id="item" class="item buy"></div>
                <div id="text"></div>
            </div>
            <div>bitflyerFX</div>
            <div id="lastprice"></div>
        </div>
        <div id="mix" class="cont">
            <div id="sell-volume" class="bar reverse">
                <div id="item" class="item sell"></div>
                <div id="text"></div>
            </div>
            <div id="buy-volume" class="bar">
                <div id="item" class="item buy"></div>
                <div id="text"></div>
            </div>
            <div>Mix</div>
        </div>
        <div id="bitflyer" class="cont">
            <div id="sell-volume" class="bar reverse">
                <div id="item" class="item sell"></div>
                <div id="text"></div>
            </div>
            <div id="buy-volume" class="bar">
                <div id="item" class="item buy"></div>
                <div id="text"></div>
            </div>
            <div>bitflyer</div>
            <div id="lastprice"></div>
        </div>
        <div id="zaif" class="cont">
            <div id="sell-volume" class="bar reverse">
                <div id="item" class="item sell"></div>
                <div id="text"></div>
            </div>
            <div id="buy-volume" class="bar">
                <div id="item" class="item buy"></div>
                <div id="text"></div>
            </div>
            <div>Zaif</div>
            <div id="lastprice"></div>
        </div>
        <div id="bitbank" class="cont">
            <div id="sell-volume" class="bar reverse">
                <div id="item" class="item sell"></div>
                <div id="text"></div>
            </div>
            <div id="buy-volume" class="bar">
                <div id="item" class="item buy"></div>
                <div id="text"></div>
            </div>
            <div>bitbank</div>
            <div id="lastprice"></div>
        </div>
        <div id="coincheck" class="cont">
            <div id="sell-volume" class="bar reverse">
                <div id="item" class="item sell"></div>
                <div id="text"></div>
            </div>
            <div id="buy-volume" class="bar">
                <div id="item" class="item buy"></div>
                <div id="text"></div>
            </div>
            <div>coincheck</div>
            <div id="lastprice"></div>
        </div>
    </div>

    <script src="https://js.pusher.com/4.2/pusher.min.js"></script>
    <script src="https://cdn.pubnub.com/sdk/javascript/pubnub.4.20.2.js"></script>
    <script type="module">
        import * as exec from './modules/src/executions2.js'

        const side = {
            SELL: 'SELL',
            BUY: 'BUY'
        }

        class Pair {
            constructor() {
                this.exec = []
                setInterval(() => {
                    // 10秒前
                    let secago = new Date()
                    secago.setSeconds(secago.getSeconds() - 10)

                    // 10秒前以前のデータをパージ
                    this.exec = this.exec.filter(e => e.date > secago)
                }, 1000)
            }
            push(exec) {
                this.exec.push(exec)
            }
            getVolume() {
                let arr = this.exec
                return arr.length > 0 ? arr.map(exec => exec.volume).reduce((x, y) => x + y) : 0
            }
            getSellVolume() {
                let arr = this.exec.filter(exec => exec.side == side.SELL)
                return arr.length > 0 ? arr.map(exec => exec.volume).reduce((x, y) => x + y) : 0
            }
            getBuyVolume() {
                let arr = this.exec.filter(exec => exec.side == side.BUY)
                return arr.length > 0 ? arr.map(exec => exec.volume).reduce((x, y) => x + y) : 0
            }
        }

        // BTC_USD
        let btcusd = new Pair()
        let btcusdTag = document.querySelector('#btcusd')
        let bitfinexLtp = btcusdTag.querySelector('#bitfinex #lastprice')
        let bitfinexBtcUsd = new Pair()
        exec.bitfinex_BTC_USD.addEventListener('message', (e) => {
            btcusd.push(e.detail)
            bitfinexLtp.textContent = e.detail.price
            bitfinexBtcUsd.push(e.detail)
        })
        let bitmexLtp = btcusdTag.querySelector('#bitmex #lastprice')
        let bitmexBtcUsd = new Pair()
        exec.bitmex_BTC_USD.addEventListener('message', (e) => {
            // btcusd.push(e.detail)
            bitmexLtp.textContent = e.detail.price
            bitmexBtcUsd.push(e.detail)
        })
        let gdaxLtp = btcusdTag.querySelector('#gdax #lastprice')
        let gdaxBtcUsd = new Pair()
        exec.gdax_BTC_USD.addEventListener('message', (e) => {
            btcusd.push(e.detail)
            gdaxLtp.textContent = e.detail.price
            gdaxBtcUsd.push(e.detail)
        })
        let okcoinLtp = btcusdTag.querySelector('#okcoin #lastprice')
        let okcoinBtcUsd = new Pair()
        exec.okcoin_BTC_USD.addEventListener('message', (e) => {
            btcusd.push(e.detail)
            okcoinLtp.textContent = e.detail.price
            okcoinBtcUsd.push(e.detail)
        })
        let bitstampLtp = btcusdTag.querySelector('#bitstamp #lastprice')
        let bitstampBtcUsd = new Pair()
        exec.bitstamp_BTC_USD.addEventListener('message', (e) => {
            btcusd.push(e.detail)
            bitstampLtp.textContent = e.detail.price
            bitstampBtcUsd.push(e.detail)
        })

        // BTC_USDT
        let btcusdt = new Pair()
        let btcusdtTag = document.querySelector('#btcusdt')
        let binanceLtp = btcusdtTag.querySelector('#binance #lastprice')
        let binanceBtcUsdt = new Pair()
        exec.binance_BTC_USDT.addEventListener('message', (e) => {
            btcusdt.push(e.detail)
            binanceLtp.textContent = e.detail.price
            binanceBtcUsdt.push(e.detail)
        })
        let okexLtp = btcusdtTag.querySelector('#okex #lastprice')
        let okexBtcUsdt = new Pair()
        exec.okex_BTC_USDT.addEventListener('message', (e) => {
            btcusdt.push(e.detail)
            okexLtp.textContent = e.detail.price
            okexBtcUsdt.push(e.detail)
        })

        // BTC_JPY
        let btcjpy = new Pair()
        let btcjpyTag = document.querySelector('#btcjpy')
        let bitflyerLtp = btcjpyTag.querySelector('#bitflyer #lastprice')
        let bitflyerBtcJpy = new Pair()
        exec.bitflyer_BTC_JPY.addEventListener('message', (e) => {
            btcjpy.push(e.detail)
            bitflyerLtp.textContent = e.detail.price
            bitflyerBtcJpy.push(e.detail)
        })
        let bitflyerFXLtp = btcjpyTag.querySelector('#bitflyerFX #lastprice')
        let bitflyerFXBtcJpy = new Pair()
        exec.bitflyer_FX_BTC_JPY.addEventListener('message', (e) => {
            // btcjpy.push(e.detail)
            bitflyerFXLtp.textContent = e.detail.price
            bitflyerFXBtcJpy.push(e.detail)
        })
        let zaifLtp = btcjpyTag.querySelector('#zaif #lastprice')
        let zaifBtcJpy = new Pair()
        exec.zaif_BTC_JPY.addEventListener('message', (e) => {
            btcjpy.push(e.detail)
            zaifLtp.textContent = e.detail.price
            zaifBtcJpy.push(e.detail)
        })
        let bitbankLtp = btcjpyTag.querySelector('#bitbank #lastprice')
        let bitbankBtcJpy = new Pair()
        exec.bitbank_BTC_JPY.addEventListener('message', (e) => {
            btcjpy.push(e.detail)
            bitbankLtp.textContent = e.detail.price
            bitbankBtcJpy.push(e.detail)
        })
        let coincheckLtp = btcjpyTag.querySelector('#coincheck #lastprice')
        let coincheckBtcJpy = new Pair()
        exec.coincheck_BTC_JPY.addEventListener('message', (e) => {
            btcjpy.push(e.detail)
            coincheckLtp.textContent = e.detail.price
            coincheckBtcJpy.push(e.detail)
        })


        let target = btcusdTag.querySelector('#mix')
        let btcusdmix = {
            sellVolume: target.querySelector('#sell-volume #item'),
            buyVolume: target.querySelector('#buy-volume #item'),
            sellText: target.querySelector('#sell-volume #text'),
            buyText: target.querySelector('#buy-volume #text')
        }
        target = btcusdTag.querySelector('#bitfinex')
        let bitfinex = {
            sellVolume: target.querySelector('#sell-volume #item'),
            buyVolume: target.querySelector('#buy-volume #item'),
            sellText: target.querySelector('#sell-volume #text'),
            buyText: target.querySelector('#buy-volume #text')
        }
        target = btcusdTag.querySelector('#bitmex')
        let bitmex = {
            sellVolume: target.querySelector('#sell-volume #item'),
            buyVolume: target.querySelector('#buy-volume #item'),
            sellText: target.querySelector('#sell-volume #text'),
            buyText: target.querySelector('#buy-volume #text')
        }
        target = btcusdTag.querySelector('#gdax')
        let gdax = {
            sellVolume: target.querySelector('#sell-volume #item'),
            buyVolume: target.querySelector('#buy-volume #item'),
            sellText: target.querySelector('#sell-volume #text'),
            buyText: target.querySelector('#buy-volume #text')
        }
        target = btcusdTag.querySelector('#okcoin')
        let okcoin = {
            sellVolume: target.querySelector('#sell-volume #item'),
            buyVolume: target.querySelector('#buy-volume #item'),
            sellText: target.querySelector('#sell-volume #text'),
            buyText: target.querySelector('#buy-volume #text')
        }
        target = btcusdTag.querySelector('#bitstamp')
        let bitstamp = {
            sellVolume: target.querySelector('#sell-volume #item'),
            buyVolume: target.querySelector('#buy-volume #item'),
            sellText: target.querySelector('#sell-volume #text'),
            buyText: target.querySelector('#buy-volume #text')
        }

        target = btcusdtTag.querySelector('#mix')
        let btcusdtmix = {
            sellVolume: target.querySelector('#sell-volume #item'),
            buyVolume: target.querySelector('#buy-volume #item'),
            sellText: target.querySelector('#sell-volume #text'),
            buyText: target.querySelector('#buy-volume #text')
        }
        target = btcusdtTag.querySelector('#binance')
        let binance = {
            sellVolume: target.querySelector('#sell-volume #item'),
            buyVolume: target.querySelector('#buy-volume #item'),
            sellText: target.querySelector('#sell-volume #text'),
            buyText: target.querySelector('#buy-volume #text')
        }
        target = btcusdtTag.querySelector('#okex')
        let okex = {
            sellVolume: target.querySelector('#sell-volume #item'),
            buyVolume: target.querySelector('#buy-volume #item'),
            sellText: target.querySelector('#sell-volume #text'),
            buyText: target.querySelector('#buy-volume #text')
        }

        target = btcjpyTag.querySelector('#mix')
        let btcjpymix = {
            sellVolume: target.querySelector('#sell-volume #item'),
            buyVolume: target.querySelector('#buy-volume #item'),
            sellText: target.querySelector('#sell-volume #text'),
            buyText: target.querySelector('#buy-volume #text')
        }
        target = btcjpyTag.querySelector('#bitflyer')
        let bitflyer = {
            sellVolume: target.querySelector('#sell-volume #item'),
            buyVolume: target.querySelector('#buy-volume #item'),
            sellText: target.querySelector('#sell-volume #text'),
            buyText: target.querySelector('#buy-volume #text')
        }
        target = btcjpyTag.querySelector('#bitflyerFX')
        let bitflyerFX = {
            sellVolume: target.querySelector('#sell-volume #item'),
            buyVolume: target.querySelector('#buy-volume #item'),
            sellText: target.querySelector('#sell-volume #text'),
            buyText: target.querySelector('#buy-volume #text')
        }
        target = btcjpyTag.querySelector('#zaif')
        let zaif = {
            sellVolume: target.querySelector('#sell-volume #item'),
            buyVolume: target.querySelector('#buy-volume #item'),
            sellText: target.querySelector('#sell-volume #text'),
            buyText: target.querySelector('#buy-volume #text')
        }
        target = btcjpyTag.querySelector('#bitbank')
        let bitbank = {
            sellVolume: target.querySelector('#sell-volume #item'),
            buyVolume: target.querySelector('#buy-volume #item'),
            sellText: target.querySelector('#sell-volume #text'),
            buyText: target.querySelector('#buy-volume #text')
        }
        target = btcjpyTag.querySelector('#coincheck')
        let coincheck = {
            sellVolume: target.querySelector('#sell-volume #item'),
            buyVolume: target.querySelector('#buy-volume #item'),
            sellText: target.querySelector('#sell-volume #text'),
            buyText: target.querySelector('#buy-volume #text')
        }
        setInterval(() => {
            btcusdmix.sellVolume.style.width = btcusd.getSellVolume() + '%'
            btcusdmix.buyVolume.style.width = btcusd.getBuyVolume() + '%'
            btcusdmix.sellText.textContent = btcusd.getSellVolume()
            btcusdmix.buyText.textContent = btcusd.getBuyVolume()

            bitfinex.sellVolume.style.width = bitfinexBtcUsd.getSellVolume() + '%'
            bitfinex.buyVolume.style.width = bitfinexBtcUsd.getBuyVolume() + '%'
            bitfinex.sellText.textContent = bitfinexBtcUsd.getSellVolume()
            bitfinex.buyText.textContent = bitfinexBtcUsd.getBuyVolume()

            bitmex.sellVolume.style.width = bitmexBtcUsd.getSellVolume() + '%'
            bitmex.buyVolume.style.width = bitmexBtcUsd.getBuyVolume() + '%'
            bitmex.sellText.textContent = bitmexBtcUsd.getSellVolume()
            bitmex.buyText.textContent = bitmexBtcUsd.getBuyVolume()

            gdax.sellVolume.style.width = gdaxBtcUsd.getSellVolume() + '%'
            gdax.buyVolume.style.width = gdaxBtcUsd.getBuyVolume() + '%'
            gdax.sellText.textContent = gdaxBtcUsd.getSellVolume()
            gdax.buyText.textContent = gdaxBtcUsd.getBuyVolume()

            okcoin.sellVolume.style.width = okcoinBtcUsd.getSellVolume() + '%'
            okcoin.buyVolume.style.width = okcoinBtcUsd.getBuyVolume() + '%'
            okcoin.sellText.textContent = okcoinBtcUsd.getSellVolume()
            okcoin.buyText.textContent = okcoinBtcUsd.getBuyVolume()

            bitstamp.sellVolume.style.width = bitstampBtcUsd.getSellVolume() + '%'
            bitstamp.buyVolume.style.width = bitstampBtcUsd.getBuyVolume() + '%'
            bitstamp.sellText.textContent = bitstampBtcUsd.getSellVolume()
            bitstamp.buyText.textContent = bitstampBtcUsd.getBuyVolume()


            btcusdtmix.sellVolume.style.width = btcusdt.getSellVolume() + '%'
            btcusdtmix.buyVolume.style.width = btcusdt.getBuyVolume() + '%'
            btcusdtmix.sellText.textContent = btcusdt.getSellVolume()
            btcusdtmix.buyText.textContent = btcusdt.getBuyVolume()

            binance.sellVolume.style.width = binanceBtcUsdt.getSellVolume() + '%'
            binance.buyVolume.style.width = binanceBtcUsdt.getBuyVolume() + '%'
            binance.sellText.textContent = binanceBtcUsdt.getSellVolume()
            binance.buyText.textContent = binanceBtcUsdt.getBuyVolume()

            okex.sellVolume.style.width = okexBtcUsdt.getSellVolume() + '%'
            okex.buyVolume.style.width = okexBtcUsdt.getBuyVolume() + '%'
            okex.sellText.textContent = okexBtcUsdt.getSellVolume()
            okex.buyText.textContent = okexBtcUsdt.getBuyVolume()


            btcjpymix.sellVolume.style.width = btcjpy.getSellVolume() + '%'
            btcjpymix.buyVolume.style.width = btcjpy.getBuyVolume() + '%'
            btcjpymix.sellText.textContent = btcjpy.getSellVolume()
            btcjpymix.buyText.textContent = btcjpy.getBuyVolume()

            bitflyer.sellVolume.style.width = bitflyerBtcJpy.getSellVolume() + '%'
            bitflyer.buyVolume.style.width = bitflyerBtcJpy.getBuyVolume() + '%'
            bitflyer.sellText.textContent = bitflyerBtcJpy.getSellVolume()
            bitflyer.buyText.textContent = bitflyerBtcJpy.getBuyVolume()

            bitflyerFX.sellVolume.style.width = bitflyerFXBtcJpy.getSellVolume() + '%'
            bitflyerFX.buyVolume.style.width = bitflyerFXBtcJpy.getBuyVolume() + '%'
            bitflyerFX.sellText.textContent = bitflyerFXBtcJpy.getSellVolume()
            bitflyerFX.buyText.textContent = bitflyerFXBtcJpy.getBuyVolume()

            zaif.sellVolume.style.width = zaifBtcJpy.getSellVolume() + '%'
            zaif.buyVolume.style.width = zaifBtcJpy.getBuyVolume() + '%'
            zaif.sellText.textContent = zaifBtcJpy.getSellVolume()
            zaif.buyText.textContent = zaifBtcJpy.getBuyVolume()

            bitbank.sellVolume.style.width = bitbankBtcJpy.getSellVolume() + '%'
            bitbank.buyVolume.style.width = bitbankBtcJpy.getBuyVolume() + '%'
            bitbank.sellText.textContent = bitbankBtcJpy.getSellVolume()
            bitbank.buyText.textContent = bitbankBtcJpy.getBuyVolume()

            coincheck.sellVolume.style.width = coincheckBtcJpy.getSellVolume() + '%'
            coincheck.buyVolume.style.width = coincheckBtcJpy.getBuyVolume() + '%'
            coincheck.sellText.textContent = coincheckBtcJpy.getSellVolume()
            coincheck.buyText.textContent = coincheckBtcJpy.getBuyVolume()
        }, 1000)
    </script>
</body>

</html>